{"version":3,"file":"testPoller.js","sourceRoot":"","sources":["../../../test/utils/testPoller.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC,kCAAkC;;AAElC,OAAO,EAAE,KAAK,EAA6C,MAAM,kBAAkB,CAAC;AACpF,OAAO,EAAE,MAAM,EAAE,MAAM,WAAW,CAAC;AAEnC,OAAO,EAAE,aAAa,EAAgD,MAAM,iBAAiB,CAAC;AAE9F;IAAgC,8BAAkC;IAGhE,oBACE,MAAyB,EACzB,YAAyB,EACzB,cAAmC,EACnC,aAAsB,EACtB,UAAgD;QAHhD,6BAAA,EAAA,iBAAyB;QAF3B,iBA8BC;QAvBC,IAAI,KAAK,GAAuB;YAC9B,MAAM,QAAA;SACP,CAAC;QAEF,IAAI,aAAa,EAAE;YACjB,KAAK,yBACA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,KAAK,GAC/B,KAAK,CACT,CAAC;SACH;QAED,IAAM,SAAS,GAAG,aAAa,uBAC1B,KAAK,KACR,MAAM,QAAA;YACN,cAAc,gBAAA,IACd,CAAC;QAEH,QAAA,kBAAM,SAAS,CAAC,SAAC;QAEjB,IAAI,UAAU,EAAE;YACd,KAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;SAC7B;QACD,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;IACnC,CAAC;IAED,sBAAW,uCAAe;aAA1B;YACE,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe,CAAC;QAC9C,CAAC;;;OAAA;IAED,sBAAW,wCAAgB;aAA3B;YACE,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,gBAAgB,CAAC;QAC/C,CAAC;;;OAAA;IAEK,0BAAK,GAAX;;;gBACE,sBAAO,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,EAAC;;;KACjC;IAED;;;;OAIG;IACI,sCAAiB,GAAxB;QACE,IAAM,KAAK,GAA6B,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;QAC7D,OAAO;YACL,8CAA8C;YAC9C,SAAS,EAAE,KAAK,CAAC,SAAS;YAC1B,WAAW,EAAE,KAAK,CAAC,WAAW;YAC9B,WAAW,EAAE,KAAK,CAAC,WAAW;YAC9B,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,MAAM,EAAE,KAAK,CAAC,MAAM;YAEpB,8DAA8D;YAC9D,6EAA6E;YAC7E,gBAAgB,EAAE,KAAK,CAAC,gBAAgB;SACzC,CAAC;IACJ,CAAC;IACH,iBAAC;AAAD,CAAC,AAnED,CAAgC,MAAM,GAmErC","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { delay, RequestOptionsBase, HttpOperationResponse } from \"@azure/core-http\";\nimport { Poller } from \"../../src\";\nimport { TestServiceClient } from \"./testServiceClient\";\nimport { makeOperation, TestOperationState, PublicTestOperationState } from \"./testOperation\";\n\nexport class TestPoller extends Poller<TestOperationState, string> {\n  public intervalInMs: number;\n\n  constructor(\n    client: TestServiceClient,\n    intervalInMs: number = 10,\n    requestOptions?: RequestOptionsBase,\n    baseOperation?: string,\n    onProgress?: (state: TestOperationState) => void\n  ) {\n    let state: TestOperationState = {\n      client\n    };\n\n    if (baseOperation) {\n      state = {\n        ...JSON.parse(baseOperation).state,\n        ...state\n      };\n    }\n\n    const operation = makeOperation({\n      ...state,\n      client,\n      requestOptions\n    });\n\n    super(operation);\n\n    if (onProgress) {\n      this.onProgress(onProgress);\n    }\n    this.intervalInMs = intervalInMs;\n  }\n\n  public get initialResponse(): HttpOperationResponse | undefined {\n    return this.operation.state.initialResponse;\n  }\n\n  public get previousResponse(): HttpOperationResponse | undefined {\n    return this.operation.state.previousResponse;\n  }\n\n  async delay(): Promise<void> {\n    return delay(this.intervalInMs);\n  }\n\n  /**\n   * The getOperationState() from TestPoller returns an object\n   * with the subset of properties from TestOperationState that are\n   * safe to be shared with the public.\n   */\n  public getOperationState(): PublicTestOperationState {\n    const state: PublicTestOperationState = this.operation.state;\n    return {\n      // Properties from PollOperationState<TResult>\n      isStarted: state.isStarted,\n      isCompleted: state.isCompleted,\n      isCancelled: state.isCancelled,\n      error: state.error,\n      result: state.result,\n\n      // The only other property needed by PublicTestOperationState.\n      // The other properties from TestOperationState will be hidden from the user.\n      previousResponse: state.previousResponse\n    };\n  }\n}\n"]}